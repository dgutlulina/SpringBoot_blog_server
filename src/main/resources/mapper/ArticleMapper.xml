<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lln.spring.mapper.ArticleMapper">

    <!-- 获取指定用户的文章列表 -->
    <select id="selectArticlesByUserId" resultType="lln.spring.entity.Article">
        SELECT * FROM t_article
        WHERE 1=1
        <if test="userId != null">
            AND author_id = #{userId}
        </if>
        ORDER BY created DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 获取指定用户点赞的文章列表 -->
    <select id="selectArticlesLikedByUserId" resultType="lln.spring.entity.Article">
        SELECT a.* FROM t_article a
        INNER JOIN t_like l ON a.id = l.article_id
        WHERE l.user_id = #{userId}
        ORDER BY l.created_at DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 获取指定用户收藏的文章列表 -->
    <select id="selectArticlesFavoritedByUserId" resultType="lln.spring.entity.Article">
        SELECT a.* FROM t_article a
        INNER JOIN t_favorite f ON a.id = f.article_id
        WHERE f.user_id = #{userId}
        ORDER BY f.created_at DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 获取指定用户文章总数 -->
    <select id="countArticlesByUserId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_article
        WHERE 1=1
        <if test="userId != null">
            AND author_id = #{userId}
        </if>
    </select>

    <!-- 获取指定用户点赞的文章总数 -->
    <select id="countArticlesLikedByUserId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_like
        WHERE user_id = #{userId}
    </select>

    <!-- 获取指定用户收藏的文章总数 -->
    <select id="countArticlesFavoritedByUserId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_favorite
        WHERE user_id = #{userId}
    </select>

</mapper>